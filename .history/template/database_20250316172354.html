<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Database Management</title>
    <link rel="stylesheet" href="styles.css">
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
</head>
<body>

    <h1>📂 Database Management</h1>

    <table>
        <tr>
            <th>ID</th>
            <th>Medicine</th>
            <th>Time</th>
            <th>Image</th>
            <th>Completed</th>
            <th>Actions</th>
        </tr>
        {% for alarm in alarms %}
        <tr>
            <td>{{ alarm.id }}</td>
            <td>{{ alarm.medicine }}</td>
            <td>{{ alarm.time }}</td>
            <td>
                {% if alarm.image %}
                    <img src="{{ alarm.image }}" alt="Medicine" width="50">
                {% else %}
                    No Image
                {% endif %}
            </td>
            <td>{{ "✅" if alarm.completed else "❌" }}</td>
            <td>
                <td>
                    <button onclick="markCompleted({{ alarm.id }})">✔ Mark Completed</button>
                    <button onclick="deleteAlarm({{ alarm.id }})">🗑 Delete</button>
                </td>
                
            </td>
        </tr>
        {% endfor %}
    </table>

    <h2>Add New Alarm</h2>
    <form id="addAlarmForm">
        <input type="text" id="medicine" placeholder="Medicine Name" required>
        <input type="time" id="time" required>
        <input type="text" id="image" placeholder="Image URL (optional)">
        <button type="submit">➕ Add Alarm</button>
    </form>

    <script>
        function deleteAlarm(id) {
            if (confirm("Are you sure you want to delete this alarm?")) {
                fetch(`/delete_alarm/${id}`, { method: "POST" })
                    .then(response => response.json())
                    .then(data => {
                        alert(data.message);
                        location.reload();
                    });
            }
        }

        function markCompleted(id) {
            fetch(`/mark_completed/${id}`, { method: "POST" })
                .then(response => response.json())
                .then(data => {
                    alert(data.message);
                    location.reload();
                });
        }

        document.getElementById("addAlarmForm").addEventListener("submit", function(event) {
            event.preventDefault();
            const medicine = document.getElementById("medicine").value;
            const time = document.getElementById("time").value;
            const image = document.getElementById("image").value || null;

            fetch("/add_alarm", {
                method: "POST",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify({ medicine, time, image })
            })
            .then(response => response.json())
            .then(data => {
                alert(data.message);
                location.reload();
            });
        });
    </script>

</body>
</html>
